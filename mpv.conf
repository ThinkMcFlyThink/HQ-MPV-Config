# https://github.com/mpv-player/mpv/issues/5296#issuecomment-356864639

window-maximized=yes
# priority=high
profile=high-quality # fast, high-quality
# libplacebo-opts=preset=high_quality

##################
# Video Profiles #
##################
vo=gpu-next  # gpu, gpu-next

# D3D
hwdec=nvdec-copy # nvdec  # no, vulkan-copy, vulkan, nvdec, d3d11va, d3d11va-copy
d3d11-adapter=NVIDIA GeForce RTX 3060 Ti
gpu-api=d3d11
gpu-context=d3d11
d3d11-flip=no # drops frames without
d3d11-exclusive-fs=yes

# VULKAN
# hwdec=no
# gpu-api=vulkan
# gpu-context=winvk
# vulkan-swap-mode=fifo
# vulkan-async-compute=no

###############
# RAM & CACHE #
###############
# cache=yes                              # uses a large seekable RAM cache even for local input.
# # cache-secs=300                        # uses extra large RAM cache (needs cache=yes to make it useful).
# demuxer-max-back-bytes=20M              # sets fast seeking
# demuxer-max-bytes=20M                   # sets fast seeking

#################
# VIDEO SCALING #
#################
# Luma upscaler
# scale=ewa_lanczossharp  # ewa_robidoux, ewa_lanczossharp, ewa_lanczos4sharpest (may come with AR?)
# scale-antiring=0.6
# https://artoriuz.github.io/blog/imagemagick_resampling.html
# scale=lanczos
# scale-blur=0.9812505644269356

# Chroma up & downscaler
# cscale=ewa_lanczossharp  # ewa_lanczos, ewa_lanczossharp, spline64, ewa_lanczos4sharpest
# cscale-antiring=0.6

# Luma downscaler
# dscale=mitchell  # spline64, lanczos
# dscale-antiring=0.6
dscale=hermite  # https://github.com/mpv-player/mpv/wiki/Downscaling-with-Hermite

correct-downscaling=yes
linear-downscaling=yes
sigmoid-upscaling=yes


######################
# VIDEO ENHANCEMENTS #
######################
brightness=0
saturation=0
gamma=0
contrast=0

#############
# DITHERING #
#############
dither-depth=no # auto, no, 8, 10
dither=no  # no, fruit, error-diffusion
temporal-dither=no
#
# https://mpv.io/manual/stable/#options-dither-size-fruit
# dither-depth=auto # auto, no, 8, 10
# dither=fruit  # no, fruit, error-diffusion
# dither-size-fruit=8
# temporal-dither=yes
# temporal-dither-period=1


#################
# DEINTERLACING #
#################
deinterlace=no # yes, no


#############
# DEBANDING #
#############
deband=no  # only turn on for videos with banding - reduces detail slightly..
# deband=yes  # only turn on for videos with banding
# deband-iterations=4  # https://mpv.io/manual/stable/#options-deband-iterations
# deband-threshold=35  # https://mpv.io/manual/stable/#options-deband-threshold
# deband-range=24      # https://mpv.io/manual/stable/#options-deband-range
# deband-grain=5       # https://mpv.io/manual/stable/#options-deband-grain


#############
# INTERFACE #
#############
# border=no # show windows titlebar instead of mpv default
osd-font='Roboto'  # ui font
osd-font-size=8
osd-bar=no  # Don't show a huge volume box on screen when turning the volume up/down
osd-bold=yes


##########
# IMAGES #
##########
image-display-duration=inf  # dont cycle through images


#########
# AUDIO #
#########
ao=wasapi
audio-channels=7.1,5.1,3.0,stereo  # 3.0, empty
audio-exclusive=yes  # requires wasapi - avoid windows resampling
ad-lavc-downmix=no #  request audio channel downmixing from the decoder (default: no). no = make the decoder always output its native layout.
ad-lavc-threads=0 # Number of threads to use for decoding. 0=all. note useless if passthru enabled.

# set initial and maximum volume to 85 (apparently avoids distortion)
volume=85 # based on MPC-HC's warning
volume-max=100

# based on # https://blog.otterbro.com/ffmpeg-audio-channel-manipulation/
# af-append=pan="3.0|FL=FL+0.5*SL+0.5*BL+LFE|FR=FR+0.5*SR+0.5*BR+LFE|FC=FC"

# manual loudnorm filter
# af-toggle=lavfi=[loudnorm=I=-16:TP=-1.5:LRA=7:measured_I=-16.5:measured_LRA=23.6:measured_TP=-0.0:measured_thresh=-29.3]

# https://github.com/mpv-player/mpv/issues/8418#issuecomment-2466772516
af-append=lavfi="lowshelf=frequency=100:gain=-2.5,dynaudnorm=compress=27.0:gausssize=53"


#############
# SUBTITLES #
#############
sid=no  # disable showing subtitles by default
sub-ass-override=force # force styling
blend-subtitles=yes
sub-auto=fuzzy  # external subs don't have to match the file name exactly to autoload

sub-font="Roboto"
sub-font-size=30
sub-border-size=2

# BLURAY-esque style # https://www.reddit.com/r/mpv/comments/uzvm8i/comment/iaj43n3/
# sub-font='Arial Regular'
# sub-border-size=1
# sub-color='#CDCDCD'
# sub-shadow=3
# sub-shadow-color='#000000'
# sub-shadow-offset=2

# remove hearing impared subtitles
sub-filter-sdh=yes
# sub-filter-sdh-harder=yes


######################
# LANGUAGE SELECTION 
######################
# For anime we want to load JP audio with ENG subs.
# alang=English,eng,en
# slang=English,eng,en

alang=Japanese,jpn,ja,English,eng,en
slang=Japanese,jpn,ja,English,eng,en  # for immersion learning


#################
# INTERPOLATION #
#################
video-sync=display-resample  # audio, display-resample, display-vdrop, display-tempo
interpolation=yes

# interpolation-threshold=-1
# video-sync-max-factor=1
# video-sync-max-video-change=5

# https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters
tscale=mitchell
scale-param1=0.6  # B
scale-param2=0.2  # C
tscale-clamp=0.2
tscale-antiring=0.5
tscale-blur=0.7

# https://github.com/mpv-player/mpv/issues/9427#issuecomment-963522463
# tscale=sphinx
# # tscale-radius=0.57
# tscale-blur=0.6991556596428412

# ???????
# tscale=sphinx
# tscale-blur=0.6991556596428412
# tscale-radius=1.05
# tscale-clamp=0.0

# https://github.com/mpv-player/mpv/issues/2685#issuecomment-533639111
# tscale=box
# tscale-window=quadric
# tscale-clamp=0.0
# tscale-radius=1.025

# https://github.com/mpv-player/mpv/issues/2685#issuecomment-537972869
# tscale=box
# tscale-window=sphinx
# tscale-radius=1.01
# tscale-clamp=0.0

####################
# DISPLAY SETTINGS #
####################
# set appropiate targets tailored for !!!!OUTPUT DISPLAY!!!!
target-prim=bt.709 # bt.2020, dci-p3, bt.709
target-trc=bt.1886 # bt.1886, srgb, gamma2.2
video-output-levels=limited # full, limited, auto - change depending on display (monitors=full, tvs=limited)
target-peak=203 # default for SDR
target-contrast=inf  # 4723, inf

# extra shaders
# glsl-shader="~~/shaders/CfL_Prediction.glsl" # UHD videos are YUV420 so chroma upscaling is needed
# glsl-shader="~~/shaders/adaptive-sharpen.glsl" # https://gist.github.com/igv  - aybe good for anime
# glsl-shader="~~/shaders/KrigBilateral.glsl" # https://gist.github.com/igv
# glsl-shader="~~/shaders/NVScaler.glsl" # https://gist.github.com/agyild

#######
# HDR #
#######
[HDR]
osd-playing-msg = "HDR"
profile-cond=get("video-params/primaries") == "bt.2020"
profile-restore=copy

# target-colorspace-hint=yes
# tone-mapping=spline # spline, bt.2446a, st2094-40, bt.2390, mobius
# # # tone-mapping-param=0.15
# gamut-mapping-mode=darken  # perceptual, relative, absolute, darken

hdr-compute-peak=yes
allow-delayed-peak-detect=no
# libplacebo-opts=color_map_preset=high_quality,lut3d_tricubic=yes,gamut_expansion=yes,gamut_mapping=perceptual,tone_mapping=linearlight
libplacebo-opts=peak_detection_preset=high_quality,color_map_preset=high_quality,lut3d_tricubic=yes,gamut_expansion=yes,gamut_mapping=softclip,tone_mapping=spline
hdr-peak-percentile=99.995  # 99.995
hdr-contrast-recovery=0

# disable DV
# vf-add=format:dolbyvision=no
